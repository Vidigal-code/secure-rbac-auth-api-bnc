services:
  mssql:
    image: mcr.microsoft.com/mssql/server:2022-latest
    environment:
      ACCEPT_EULA: "Y"
      MSSQL_PID: "Express"
      MSSQL_SA_PASSWORD: "${DB_PASSWORD:-YourStrong!Passw0rd}"
    ports:
      - "1433:1433"
    volumes:
      - mssql_data:/var/opt/mssql

  api:
    build: .
    depends_on:
      - mssql
    environment:
      PORT: "3000"
      NODE_ENV: "${NODE_ENV:-development}"
      DATABASE_URL: "sqlserver://mssql:1433;database=${DB_NAME:-secure_rbac_auth};user=sa;password=${DB_PASSWORD:-YourStrong!Passw0rd};encrypt=true;trustServerCertificate=true"
      JWT_SECRET: "${JWT_SECRET:-troque-este-segredo}"
      JWE_SECRET: "${JWE_SECRET:-troque-este-segredo-jwe}"
      JWT_EXPIRES_IN_SECONDS: "${JWT_EXPIRES_IN_SECONDS:-3600}"
      TOKEN_ISSUER: "${TOKEN_ISSUER:-secure-rbac-auth-api-bnc}"
      TOKEN_AUDIENCE: "${TOKEN_AUDIENCE:-secure-rbac-auth-api-bnc}"
      CORS_ORIGINS: "${CORS_ORIGINS:-}"
      HELMET_CSP_ENABLED: "${HELMET_CSP_ENABLED:-false}"
      SEED_ADMIN_EMAIL: "${SEED_ADMIN_EMAIL:-admin@local.test}"
      SEED_ADMIN_PASSWORD: "${SEED_ADMIN_PASSWORD:-Admin@123}"
      SEED_USER_EMAIL: "${SEED_USER_EMAIL:-user@local.test}"
      SEED_USER_PASSWORD: "${SEED_USER_PASSWORD:-User@123}"
    ports:
      - "3000:3000"

volumes:
  mssql_data:


